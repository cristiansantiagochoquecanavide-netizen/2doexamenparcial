import{u as G,a as l,j as s}from"./index-ChjEM8xn.js";import{b as r}from"./react-vendor-AZ7bSPkM.js";import"./axios-vendor-R-lXtGyY.js";const g={1:"Lunes",2:"Martes",3:"Miércoles",4:"Jueves",5:"Viernes",6:"Sábado",7:"Domingo"},H={periodo:"",dia:"",franja:"",capacidad:"",sede:""},X=()=>{const{isCoordinador:v}=G(),[t,A]=r.useState(H),[x,N]=r.useState(["Disponible"]),D=["Disponible","Ocupado","Mantenimiento"],[S,j]=r.useState([]),[C,i]=r.useState(""),[p,n]=r.useState(!1),[E,w]=r.useState([]),[_,R]=r.useState([]),[k,y]=r.useState([]),[z,M]=r.useState([]),[F,U]=r.useState([]);r.useEffect(()=>{l.get("/periodos-academicos").then(a=>{w(a.data.data||[])}),l.get("/horarios").then(a=>{const e=a.data&&a.data.data?a.data.data:Array.isArray(a.data)?a.data:[],u=[...new Set(e.map(c=>c.dias_semana).filter(Boolean))].map(c=>g[c]||c);if(R(u),t.dia){const c=e.filter(d=>d.dias_semana===t.dia).map(d=>`${d.hora_inicio} - ${d.hora_fin}`);y([...new Set(c)])}else{const c=e.map(d=>`${d.hora_inicio} - ${d.hora_fin}`);y([...new Set(c)])}}),l.get("/aulas").then(a=>{const e=a.data&&a.data.data?a.data.data:Array.isArray(a.data)?a.data:[],o=[...new Set(e.map(u=>parseInt(u.capacidad,10)).filter(u=>!isNaN(u)&&u>0))];M(o)}),l.get("/infraestructura").then(a=>{const e=a.data&&a.data.data?a.data.data:Array.isArray(a.data)?a.data:[],o=[...new Set(e.map(u=>u.nombre_infr).filter(Boolean))];U(o)})},[]);const h=a=>{const{name:e,value:o,type:u,checked:c}=a.target;if(e==="estadoAula"){N(d=>c?[...d,o]:d.filter(f=>f!==o));return}A(d=>{const f={...d,[e]:o};return e==="dia"&&(l.get("/horarios").then(m=>{const J=m.data&&m.data.data?m.data.data:Array.isArray(m.data)?m.data:[],T=Object.keys(g).find(b=>g[b]===o)||o,V=J.filter(b=>b.dias_semana==T).map(b=>`${b.hora_inicio} - ${b.hora_fin}`);y([...new Set(V)])}),f.franja=""),f})},$=async()=>{n(!0),i(""),j([]);try{const{data:a}=await l.post("/disponibilidad-aulas/consultar-aulas",t);a&&a.aulas&&Array.isArray(a.aulas)?(j(a.aulas),a.aulas.length===0&&i("No se encontraron aulas para los filtros seleccionados.")):i("No se pudo obtener la disponibilidad.")}catch(a){a.response&&a.response.data&&a.response.data.message?i(a.response.data.message):i("Error al consultar la disponibilidad.")}finally{n(!1)}},P=async()=>{n(!0),i("");try{const{data:a}=await l.post("/disponibilidad-aulas/solicitar-disponibilidad",t);i("Disponibilidad solicitada."),j(a.disponibilidad||[])}catch{i("Error al solicitar disponibilidad.")}finally{n(!1)}},q=async()=>{n(!0),i("");try{const a={...t,estados:x},{data:e}=await l.post("/disponibilidad-aulas/consultar-estado",a);i("Estado de aulas consultado."),j(e.estados||e.aulas||[])}catch{i("Error al consultar estado de aulas.")}finally{n(!1)}},I=async()=>{n(!0),i("");try{const{data:a}=await l.post("/disponibilidad-aulas/registrar-consulta",t);i(a.registrado?"Consulta registrada en bitácora.":"No se pudo registrar la consulta.")}catch{i("Error al registrar consulta.")}finally{n(!1)}},L=async()=>{n(!0),i("");try{const{data:a}=await l.post("/disponibilidad-aulas/confirmar-registro",t);i(a.confirmado?"Registro confirmado en bitácora.":"No se pudo confirmar el registro.")}catch{i("Error al confirmar registro.")}finally{n(!1)}},O=async()=>{n(!0),i("");try{const{data:a}=await l.post("/disponibilidad-aulas/actualizar-disponibilidad",t);i(a.actualizado?"Disponibilidad actualizada.":"No se pudo actualizar la disponibilidad.")}catch{i("Error al actualizar disponibilidad.")}finally{n(!1)}},B=async()=>{n(!0),i("");try{const{data:a}=await l.post("/disponibilidad-aulas/mostrar-resultados",t);i("Resultados consultados."),j(a.resultados||[])}catch{i("Error al mostrar resultados.")}finally{n(!1)}};return s.jsxs("div",{className:"disponibilidad-aulas-container",children:[s.jsx("h2",{children:"CU13 - Consultar disponibilidad de aulas"}),s.jsxs("form",{className:"filtros-form",onSubmit:a=>{a.preventDefault(),$()},children:[s.jsxs("label",{children:[s.jsx("span",{children:"Periodo"}),s.jsxs("select",{name:"periodo",value:t.periodo,onChange:h,required:!0,children:[s.jsx("option",{value:"",children:"Seleccione"}),E.map((a,e)=>s.jsx("option",{value:a,children:a},e))]})]}),s.jsxs("label",{children:[s.jsx("span",{children:"Día"}),s.jsxs("select",{name:"dia",value:t.dia,onChange:h,required:!0,children:[s.jsx("option",{value:"",children:"Seleccione"}),_.map((a,e)=>s.jsx("option",{value:a,children:a},e))]})]}),s.jsxs("label",{children:[s.jsx("span",{children:"Franja"}),s.jsxs("select",{name:"franja",value:t.franja,onChange:h,required:!0,children:[s.jsx("option",{value:"",children:"Seleccione"}),k.map((a,e)=>s.jsx("option",{value:a,children:a},e))]})]}),s.jsxs("label",{children:[s.jsx("span",{children:"Capacidad"}),s.jsxs("select",{name:"capacidad",value:t.capacidad,onChange:h,children:[s.jsx("option",{value:"",children:"Seleccione"}),z.map((a,e)=>s.jsx("option",{value:a,children:a},e))]})]}),s.jsxs("label",{children:[s.jsx("span",{children:"Sede"}),s.jsxs("select",{name:"sede",value:t.sede,onChange:h,children:[s.jsx("option",{value:"",children:"Seleccione"}),F.map((a,e)=>s.jsx("option",{value:a,children:a},e))]})]}),s.jsx("button",{type:"submit",disabled:p,children:"Consultar disponibilidad"})]}),s.jsxs("div",{className:"botones-cu13",children:[!v&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn-cu13",type:"button",onClick:P,disabled:p,children:"Solicitar Disponibilidad"}),s.jsx("button",{className:"btn-cu13",type:"button",onClick:I,disabled:p,children:"Registrar Consulta"}),s.jsx("button",{className:"btn-cu13",type:"button",onClick:L,disabled:p,children:"Confirmar Registro"}),s.jsx("button",{className:"btn-cu13",type:"button",onClick:O,disabled:p,children:"Actualizar Disponibilidad"}),s.jsx("button",{className:"btn-cu13",type:"button",onClick:B,disabled:p,children:"Mostrar Resultados"})]}),s.jsx("div",{style:{display:"inline-block",marginRight:16},children:D.map(a=>s.jsxs("label",{style:{marginRight:8},children:[s.jsx("input",{type:"checkbox",name:"estadoAula",value:a,checked:x.includes(a),onChange:h})," ",a]},a))}),s.jsx("button",{className:"btn-cu13",type:"button",onClick:q,disabled:p,children:"Consultar Estado Aulas"})]}),C==="Estado de aulas consultado."&&s.jsx("div",{className:"mensaje-exito",children:C}),S.length>0&&s.jsxs("div",{className:"resultado",children:[s.jsx("h3",{children:"Resultado"}),(()=>{const a=S.filter(e=>x.includes((e.estado||"").toString()));return a.length===0?s.jsx("div",{children:"No hay aulas con los estados seleccionados."}):s.jsxs("table",{children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Aula"}),s.jsx("th",{children:"Estado"}),s.jsx("th",{children:"Capacidad"}),s.jsx("th",{children:"Sede"})]})}),s.jsx("tbody",{children:a.map((e,o)=>s.jsxs("tr",{children:[s.jsx("td",{children:e.nro_aula||e.aula||e.nombre||"-"}),s.jsx("td",{children:e.estado||"-"}),s.jsx("td",{children:e.capacidad||"-"}),s.jsx("td",{children:e.sede||"-"})]},o))})]})})()]})]})};export{X as default};
