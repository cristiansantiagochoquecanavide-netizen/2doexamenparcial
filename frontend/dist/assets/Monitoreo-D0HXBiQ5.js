import{j as e,u as b,a as j}from"./index-FLdvt5S5.js";import{R as A,b as c,u as F}from"./react-vendor-AZ7bSPkM.js";import T from"./Dashboard-BikTzNEA.js";import"./axios-vendor-R-lXtGyY.js";class $ extends A.Component{constructor(r){super(r),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(r){return{hasError:!0}}componentDidCatch(r,x){console.error("ðŸ”´ ErrorBoundary capturÃ³ error:",r),console.error("ðŸ”´ Error Info:",x),this.setState({error:r,errorInfo:x})}render(){return this.state.hasError?e.jsxs("div",{className:"error-boundary",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("h2",{children:"âŒ Algo saliÃ³ mal"}),e.jsx("p",{children:"Ha ocurrido un error al renderizar el componente."}),e.jsxs("div",{className:"error-details",children:[e.jsx("h3",{children:"Detalles del error:"}),e.jsx("pre",{children:this.state.error&&this.state.error.toString()}),this.state.errorInfo&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Stack Trace:"}),e.jsx("pre",{children:this.state.errorInfo.componentStack})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Recargar pÃ¡gina"})]}),e.jsx("style",{children:`
            .error-boundary {
              padding: 20px;
              background-color: #f8d7da;
              border: 1px solid #f5c6cb;
              border-radius: 4px;
            }

            .error-container {
              max-width: 800px;
              margin: 0 auto;
            }

            .error-container h2 {
              color: #721c24;
              margin-top: 0;
            }

            .error-details {
              background-color: #fff;
              border: 1px solid #dee2e6;
              border-radius: 4px;
              padding: 15px;
              margin: 15px 0;
              overflow-x: auto;
            }

            .error-details pre {
              background-color: #f5f5f5;
              padding: 10px;
              border-radius: 3px;
              font-size: 12px;
              overflow-x: auto;
              color: #721c24;
            }

            .btn {
              padding: 10px 20px;
              border: none;
              border-radius: 4px;
              cursor: pointer;
              font-size: 14px;
            }

            .btn-primary {
              background-color: #007bff;
              color: white;
            }

            .btn-primary:hover {
              background-color: #0056b3;
            }
          `})]}):this.props.children}}const G=()=>{const{user:v}=b(),[r,x]=c.useState("horarios_semanales"),[o,t]=c.useState("pdf"),[l,f]=c.useState({periodo_academico:"",docente_id:"",grupo_id:""}),[d,a]=c.useState(!1),[u,p]=c.useState(""),[y,w]=c.useState([]),[_,C]=c.useState([]),[E,R]=c.useState([]),[m,D]=c.useState([]),[N,S]=c.useState(!1);c.useEffect(()=>{k()},[]);const k=async()=>{try{const[s,i,h]=await Promise.all([j.get("/periodos-academicos").catch(()=>({data:{data:[]}})),j.get("/docentes").catch(()=>({data:{data:[]}})),j.get("/grupos").catch(()=>({data:{data:[]}}))]);w(s.data.data||[]),C(i.data.data||[]),R(h.data.data||[])}catch(s){console.error("Error al cargar datos:",s)}},g=s=>{const{name:i,value:h}=s.target;f(n=>({...n,[i]:h}))},P=async()=>{try{a(!0),p("");const s={tipo_reporte:r,formato:o,previsualizar:!0,...l},i=await j.post("/reportes/generar",s);i.data.success?(D(i.data.data||[]),S(!0),p("PrevisualizaciÃ³n cargada correctamente")):p("Error al cargar previsualizaciÃ³n")}catch(s){console.error("Error:",s),p("Error al cargar previsualizaciÃ³n: "+(s.response?.data?.message||s.message))}finally{a(!1)}},z=async()=>{try{a(!0),p("");const s={tipo_reporte:r,formato:o,...l},i=await j.post("/reportes/generar",s,{responseType:"blob"}),h=window.URL.createObjectURL(new Blob([i.data])),n=document.createElement("a");n.href=h,n.setAttribute("download",`reporte_${r}_${new Date().getTime()}.${o==="pdf"?"pdf":"csv"}`),document.body.appendChild(n),n.click(),n.remove(),p("Reporte generado y descargado exitosamente")}catch(s){console.error("Error:",s),p("Error al generar reporte: "+(s.response?.data?.message||s.message))}finally{a(!1)}};return e.jsxs("div",{className:"generar-reportes-container",children:[e.jsx("div",{className:"reportes-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("div",{className:"header-icon",children:e.jsx("i",{className:"fas fa-file-chart"})}),e.jsxs("div",{className:"header-text",children:[e.jsx("h1",{children:"Generar Reportes"}),e.jsx("p",{children:"Exporta reportes acadÃ©micos en formato PDF o Excel"})]})]})}),u&&e.jsxs("div",{className:`alert ${u.includes("Error")||u.includes("error")?"alert-error":"alert-success"}`,children:[e.jsx("i",{className:`fas ${u.includes("Error")||u.includes("error")?"fa-exclamation-circle":"fa-check-circle"}`}),e.jsx("span",{children:u})]}),e.jsxs("div",{className:"reportes-grid",children:[e.jsxs("div",{className:"config-panel",children:[e.jsxs("div",{className:"panel-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("i",{className:"fas fa-cog"}),e.jsx("h3",{children:"ConfiguraciÃ³n del Reporte"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx("i",{className:"fas fa-chart-bar"}),"Tipo de Reporte"]}),e.jsxs("select",{value:r,onChange:s=>x(s.target.value),className:"form-control",children:[e.jsx("option",{value:"horarios_semanales",children:"Horarios Semanales"}),e.jsx("option",{value:"asistencia_docente",children:"Asistencia por Docente y Grupo"}),e.jsx("option",{value:"aulas_disponibles",children:"Aulas Disponibles"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx("i",{className:"fas fa-file-export"}),"Formato de ExportaciÃ³n"]}),e.jsxs("div",{className:"formato-cards",children:[e.jsxs("div",{className:`formato-card ${o==="pdf"?"active":""}`,onClick:()=>t("pdf"),children:[e.jsx("input",{type:"radio",value:"pdf",checked:o==="pdf",onChange:s=>t(s.target.value)}),e.jsx("div",{className:"formato-icon pdf",children:e.jsx("i",{className:"fas fa-file-pdf"})}),e.jsx("span",{children:"PDF"})]}),e.jsxs("div",{className:`formato-card ${o==="excel"?"active":""}`,onClick:()=>t("excel"),children:[e.jsx("input",{type:"radio",value:"excel",checked:o==="excel",onChange:s=>t(s.target.value)}),e.jsx("div",{className:"formato-icon excel",children:e.jsx("i",{className:"fas fa-file-excel"})}),e.jsx("span",{children:"Excel"})]})]})]})]}),e.jsxs("div",{className:"panel-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("i",{className:"fas fa-filter"}),e.jsx("h3",{children:"Filtros de BÃºsqueda"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx("i",{className:"fas fa-calendar-alt"}),"PerÃ­odo AcadÃ©mico"]}),e.jsxs("select",{name:"periodo_academico",value:l.periodo_academico,onChange:g,className:"form-control",children:[e.jsx("option",{value:"",children:"Todos los perÃ­odos"}),y.map((s,i)=>e.jsx("option",{value:s,children:s},i))]})]}),r!=="aulas_disponibles"&&e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx("i",{className:"fas fa-user-tie"}),"Docente"]}),e.jsxs("select",{name:"docente_id",value:l.docente_id,onChange:g,className:"form-control",children:[e.jsx("option",{value:"",children:"Todos los docentes"}),_.map(s=>e.jsx("option",{value:s.codigo_doc,children:s.nombre_completo||`Docente ${s.codigo_doc}`},s.codigo_doc))]})]}),r==="asistencia_docente"&&e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx("i",{className:"fas fa-users"}),"Grupo"]}),e.jsxs("select",{name:"grupo_id",value:l.grupo_id,onChange:g,className:"form-control",children:[e.jsx("option",{value:"",children:"Todos los grupos"}),E.map(s=>e.jsx("option",{value:s.codigo_grupo,children:s.codigo_grupo},s.codigo_grupo))]})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{onClick:P,disabled:d,className:"btn btn-preview",children:[e.jsx("i",{className:"fas fa-eye"}),d?"Cargando...":"Previsualizar"]}),e.jsxs("button",{onClick:z,disabled:d,className:"btn btn-generate",children:[e.jsx("i",{className:"fas fa-download"}),d?"Generando...":`Generar ${o.toUpperCase()}`]})]})]}),N&&m.length>0&&e.jsxs("div",{className:"preview-panel",children:[e.jsxs("div",{className:"preview-header",children:[e.jsxs("div",{className:"preview-title",children:[e.jsx("i",{className:"fas fa-table"}),e.jsx("h3",{children:"PrevisualizaciÃ³n"})]}),e.jsxs("div",{className:"preview-badge",children:[m.length," registro",m.length!==1?"s":""]})]}),e.jsxs("div",{className:"preview-content",children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"preview-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:Object.keys(m[0]).map(s=>e.jsx("th",{children:s},s))})}),e.jsx("tbody",{children:m.slice(0,10).map((s,i)=>e.jsx("tr",{children:Object.values(s).map((h,n)=>e.jsx("td",{children:h},n))},i))})]})}),m.length>10&&e.jsxs("div",{className:"preview-footer",children:[e.jsx("i",{className:"fas fa-info-circle"}),"Mostrando 10 de ",m.length," registros"]})]})]}),!N&&e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon",children:e.jsx("i",{className:"fas fa-chart-line"})}),e.jsx("h3",{children:"Sin PrevisualizaciÃ³n"}),e.jsx("p",{children:'Selecciona los filtros y haz clic en "Previsualizar" para ver los datos'})]})]})]})},O=()=>{F();const{user:v}=b(),r=[{id:"dashboard",name:"CU16 - Visualizar Dashboard",description:"Indicadores de planificaciÃ³n, asistencia y conflictos",icon:"ðŸ“Š",component:T,roles:["Administrador","Coordinador AcadÃ©mico","Docente"]},{id:"reportes",name:"CU17 - Generar Reportes (PDF/Excel)",description:"Obtener reportes operacionales/gerenciales (asignaciones, asistencia, inasistencias, ocupaciÃ³n)",icon:"ðŸ“„",component:G,roles:["Administrador","Coordinador AcadÃ©mico","Docente"]}],x=v?.rol?.nombre||"",o=r.filter(a=>!a.roles||a.roles.length===0||a.roles.includes(x)),[t,l]=c.useState(o.length>0?o[0].id:"dashboard"),f=r.find(a=>a.id===t),d=f?.component;return e.jsxs("div",{className:"monitoreo-container",children:[e.jsx("div",{className:"monitoreo-header",children:e.jsxs("div",{className:"monitoreo-title",children:[e.jsx("h1",{children:"Monitoreo y Reportes"}),e.jsx("p",{children:"Paquete P5 - Indicadores y anÃ¡lisis de procesos acadÃ©micos"})]})}),e.jsxs("div",{className:"monitoreo-content",children:[e.jsxs("div",{className:"monitoreo-menu",children:[e.jsx("div",{className:"menu-tabs",children:o.map(a=>e.jsxs("button",{className:`menu-tab ${t===a.id?"active":""}`,onClick:()=>l(a.id),title:a.description,children:[e.jsx("span",{className:"tab-icon",children:a.icon}),e.jsx("span",{className:"tab-name",children:a.name})]},a.id))}),e.jsx("div",{className:"menu-info",children:e.jsx("p",{className:"info-description",children:f?.description})})]}),e.jsx("div",{className:"monitoreo-view",children:e.jsx($,{children:d?e.jsx(d,{}):e.jsx("div",{className:"no-access",children:e.jsx("p",{children:"No tienes acceso a este componente"})})})})]})]})};export{O as default};
