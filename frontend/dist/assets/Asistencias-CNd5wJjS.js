import{a as m,j as e,u as A}from"./index-ChjEM8xn.js";import{b as s}from"./react-vendor-AZ7bSPkM.js";/* empty css             *//* empty css                             */import"./axios-vendor-R-lXtGyY.js";const R=()=>{const[u,c]=s.useState([]),[t,f]=s.useState(""),[o,g]=s.useState(60),[d,x]=s.useState(!1),[r,v]=s.useState(null),[j,l]=s.useState(""),[h,N]=s.useState([]);s.useEffect(()=>{S(),i()},[]);const S=async()=>{try{const{data:a}=await m.get("/asignaciones");c(a.data||a)}catch(a){console.error("Error al cargar asignaciones:",a)}},i=async()=>{try{const{data:a}=await m.get("/asistencia/sesiones-activas");N(a.data||[])}catch(a){console.error("Error al cargar sesiones:",a)}},p=async a=>{if(a.preventDefault(),!t){l("Selecciona una asignaci贸n");return}try{x(!0),l("");const{data:n}=await m.post("/asistencia/generar-qr",{id_asignacion:parseInt(t),duracion_minutos:o});n.success&&(v(n.data),i())}catch(n){l(n.response?.data?.message||"Error al generar QR")}finally{x(!1)}},b=()=>{if(!r)return;const a=document.createElement("a");a.href=r.qr_base64,a.download=`asistencia-qr-${r.token}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a)},Q=()=>{r&&(navigator.clipboard.writeText(r.url_registro),alert("Enlace copiado al portapapeles"))},y=async a=>{if(window.confirm("驴Deseas cerrar esta sesi贸n?"))try{await m.post("/asistencia/cerrar-sesion",{id_sesion:a}),i()}catch{alert("Error al cerrar la sesi贸n")}},q=a=>u.find(n=>n.id_asignacion==a);return e.jsx("div",{className:"generar-qr",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"Generar QR de Asistencia"}),e.jsx("p",{className:"subtitle",children:"Crea un c贸digo QR para que tus estudiantes registren asistencia"}),j&&e.jsx("div",{className:"alert alert-error",children:j}),e.jsxs("div",{className:"content-grid",children:[e.jsx("div",{className:"form-section",children:e.jsxs("form",{onSubmit:p,className:"form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"asignacion",children:"Selecciona la Asignaci贸n *"}),e.jsxs("select",{id:"asignacion",value:t,onChange:a=>f(a.target.value),className:"form-control",required:!0,children:[e.jsx("option",{value:"",children:"-- Selecciona una asignaci贸n --"}),u.map(a=>e.jsxs("option",{value:a.id_asignacion,children:[a.grupo?.materia?.nombre_materia," - Grupo ",a.codigo_grupo," (Aula ",a.nro_aula,")"]},a.id_asignacion))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"duracion",children:"Duraci贸n de Sesi贸n (minutos)"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{id:"duracion",type:"number",value:o,onChange:a=>g(Math.min(480,Math.max(5,parseInt(a.target.value)||5))),min:"5",max:"480",className:"form-control"}),e.jsxs("span",{className:"help-text",children:[Math.floor(o/60),"h ",o%60,"m"]})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:d,children:d?"Generando...":" Generar QR"})]})}),r&&e.jsx("div",{className:"qr-section",children:e.jsxs("div",{className:"qr-card",children:[e.jsx("h3",{children:"C贸digo QR Generado"}),e.jsx("img",{src:r.qr_base64,alt:"QR Code",className:"qr-image"}),e.jsxs("div",{className:"qr-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Token:"})," ",r.token]}),e.jsxs("p",{children:[e.jsx("strong",{children:"V谩lido hasta:"})," ",new Date(r.fecha_expiracion).toLocaleString()]})]}),e.jsxs("div",{className:"qr-actions",children:[e.jsx("button",{onClick:b,className:"btn btn-secondary",children:"猬锔 Descargar QR"}),e.jsx("button",{onClick:Q,className:"btn btn-secondary",children:" Copiar Enlace"})]}),e.jsxs("div",{className:"enlace-registro",children:[e.jsx("p",{className:"label",children:"Enlace de Registro:"}),e.jsx("code",{children:r.url_registro})]})]})})]}),h.length>0&&e.jsxs("div",{className:"sesiones-section",children:[e.jsx("h2",{children:"Sesiones Activas"}),e.jsx("div",{className:"sesiones-grid",children:h.map(a=>{const n=q(a.id_asignacion),E=new Date(a.fecha_expiracion)-new Date,_=Math.floor(E/6e4);return e.jsxs("div",{className:"sesion-card",children:[e.jsxs("div",{className:"sesion-header",children:[e.jsx("h4",{children:n?.grupo?.materia?.nombre_materia}),e.jsxs("span",{className:`badge ${_>10?"badge-active":"badge-expiring"}`,children:[_,"m restantes"]})]}),e.jsxs("div",{className:"sesion-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Grupo:"})," ",n?.codigo_grupo]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Aula:"})," ",n?.nro_aula]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Token:"})," ",a.token.substring(0,8),"..."]})]}),e.jsx("button",{onClick:()=>y(a.id_sesion),className:"btn btn-small btn-danger",children:"Cerrar Sesi贸n"})]},a.id_sesion)})})]}),e.jsxs("div",{className:"info-box",children:[e.jsx("h4",{children:"癸 Instrucciones de Uso:"}),e.jsxs("ol",{children:[e.jsx("li",{children:"Selecciona la asignaci贸n para la cual deseas generar el QR"}),e.jsx("li",{children:"Establece la duraci贸n de la sesi贸n (de 5 minutos a 8 horas)"}),e.jsx("li",{children:'Haz clic en "Generar QR"'}),e.jsx("li",{children:"Descarga el QR o copia el enlace para compartir con tus estudiantes"}),e.jsx("li",{children:"Los estudiantes escanean el QR o usan el enlace para registrar su asistencia"}),e.jsx("li",{children:"Puedes cerrar la sesi贸n manualmente en cualquier momento"})]})]})]})})};function I(){const{user:u}=A(),[c,t]=s.useState("generar-qr"),[f,o]=s.useState([]),[g,d]=s.useState(!0),[x,r]=s.useState(!1),[v,j]=s.useState(null),[l,h]=s.useState(null),[N,S]=s.useState({docente_id:"",fecha:"",hora_entrada:"",hora_salida:"",estado:"Presente",observaciones:""}),i=u?.rol?.nombre_rol==="Docente";s.useEffect(()=>{i||p()},[i]);const p=async()=>{try{d(!0),o([{id:1,docente:"Dr. Juan Garc铆a",fecha:"2025-11-08",hora_entrada:"08:00",hora_salida:"17:00",estado:"Presente",observaciones:""},{id:2,docente:"Dra. Mar铆a L贸pez",fecha:"2025-11-08",hora_entrada:"08:30",hora_salida:"",estado:"Tarde",observaciones:"Lleg贸 tarde 30 minutos"}]),h(null)}catch(b){h("Error al cargar las asistencias"),console.error("Error:",b)}finally{d(!1)}};return g&&!i?e.jsx("div",{className:"loading",children:"Cargando asistencias..."}):i?e.jsx("div",{className:"crud-container",children:e.jsx(R,{})}):e.jsxs("div",{className:"crud-container",children:[e.jsxs("div",{className:"crud-header",children:[e.jsx("h1",{children:"Asistencia Docente"}),e.jsx("p",{className:"subtitle",children:"Gestiona asistencias, genera QR y registra acceso"})]}),e.jsxs("div",{className:"tabs-container-modern",children:[e.jsx("button",{className:`tab-btn-modern ${c==="generar-qr"?"active":""}`,onClick:()=>t("generar-qr"),children:e.jsx("span",{className:"tab-text",children:"Generar QR"})}),e.jsx("button",{className:`tab-btn-modern ${c==="registrar"?"active":""}`,onClick:()=>t("registrar"),children:e.jsx("span",{className:"tab-text",children:"Registrar Asistencia"})})]}),l&&e.jsx("div",{className:"alert alert-danger",children:l}),c==="generar-qr"&&e.jsx("div",{className:"tab-content",children:e.jsx(R,{})}),c==="registrar"&&e.jsx("div",{className:"tab-content",children:e.jsxs("div",{className:"info-box",children:[e.jsx("h3",{children:" Registrar Asistencia por QR"}),e.jsx("p",{children:"Para registrar tu asistencia, necesitas escanear un c贸digo QR generado por un docente o coordinador."}),e.jsxs("ol",{children:[e.jsx("li",{children:"Solicita al docente que genere un c贸digo QR"}),e.jsx("li",{children:"Escanea el c贸digo QR con tu dispositivo"}),e.jsx("li",{children:"Se abrir谩 autom谩ticamente el formulario de registro"}),e.jsx("li",{children:"Completa los datos y confirma tu asistencia"})]}),e.jsxs("p",{className:"highlight",children:["癸 Si tienes un c贸digo QR, haz clic ",e.jsx("a",{href:"#",onClick:()=>alert("Pide al docente el enlace del QR"),children:"aqu铆"})," para registrarte."]})]})})]})}export{I as default};
