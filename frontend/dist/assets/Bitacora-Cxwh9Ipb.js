import{a as x,j as a}from"./index-ChjEM8xn.js";import{b as t}from"./react-vendor-AZ7bSPkM.js";import"./axios-vendor-R-lXtGyY.js";const _=()=>{const[c,u]=t.useState([]),[g,l]=t.useState(!1),[s,h]=t.useState({}),[o,m]=t.useState(1),[d,i]=t.useState(null);t.useEffect(()=>{p(1);const e=setInterval(()=>{p(o)},5e3);return()=>clearInterval(e)},[o]);const p=async(e=1)=>{l(!0),i(null);try{const r=await x.get("/bitacora",{params:{page:e,per_page:50}});r.data.success?(u(r.data.data),h(r.data.pagination)):i(r.data.message||"Error al cargar bitácora")}catch(r){console.error("Error al cargar bitácora:",r),r.response?.status===401?i("No autenticado. Por favor, inicia sesión."):r.response?.status===403?i("No tienes permiso para ver la bitácora."):i(r.response?.data?.message||"Error al conectar con el servidor")}finally{l(!1)}},n=e=>{m(e)};return a.jsxs("div",{className:"bitacora-container",children:[a.jsxs("div",{className:"bitacora-header",children:[a.jsx("h1",{children:"Bitácora"}),a.jsx("p",{className:"subtitle",children:g?"Actualizando...":"Actualizado automáticamente cada 5 segundos"})]}),d&&a.jsxs("div",{style:{backgroundColor:"#fee2e2",border:"1px solid #fca5a5",color:"#b91c1c",padding:"12px 16px",borderRadius:"6px",marginBottom:"20px"},children:[a.jsx("strong",{children:"Error:"})," ",d]}),a.jsx("div",{className:"bitacora-table-container",children:a.jsxs("table",{className:"bitacora-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"ID"}),a.jsx("th",{children:"Usuario"}),a.jsx("th",{children:"Acción"}),a.jsx("th",{children:"Módulo"}),a.jsx("th",{children:"Fecha"})]})}),a.jsx("tbody",{children:c.length>0?c.map(e=>a.jsxs("tr",{className:"bitacora-row",children:[a.jsx("td",{className:"id-cell",children:e.id_bit}),a.jsx("td",{className:"usuario-cell",children:e.usuario?.persona?.nombre_completo||e.usuario?.ci_persona||"Sistema"}),a.jsx("td",{className:"accion-cell",children:e.accion}),a.jsx("td",{className:"modulo-cell",children:e.modulo}),a.jsx("td",{className:"fecha-cell",children:new Date(e.fecha_accion).toLocaleString("es-ES")})]},e.id_bit)):a.jsx("tr",{children:a.jsx("td",{colSpan:"5",className:"sin-datos",children:"No hay registros"})})})]})}),s.last_page>1&&a.jsxs("div",{className:"paginacion",children:[a.jsx("button",{onClick:()=>n(1),disabled:s.current_page===1,className:"btn-paginacion",title:"Primera página",children:"⏮"}),a.jsx("button",{onClick:()=>n(s.current_page-1),disabled:s.current_page===1,className:"btn-paginacion",title:"Página anterior",children:"◀"}),a.jsxs("span",{className:"pagina-info",children:["Página ",s.current_page," de ",s.last_page]}),a.jsx("button",{onClick:()=>n(s.current_page+1),disabled:s.current_page===s.last_page,className:"btn-paginacion",title:"Siguiente página",children:"▶"}),a.jsx("button",{onClick:()=>n(s.last_page),disabled:s.current_page===s.last_page,className:"btn-paginacion",title:"Última página",children:"⏭"})]})]})};export{_ as default};
