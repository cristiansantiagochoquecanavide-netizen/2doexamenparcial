import{a as N,j as s}from"./index-FLdvt5S5.js";import{f as I,b as r}from"./react-vendor-AZ7bSPkM.js";import"./axios-vendor-R-lXtGyY.js";const D=()=>{const{token:o}=I(),[f,v]=r.useState(null),[i,b]=r.useState(null),[e,S]=r.useState(null),[E,l]=r.useState(!0),[d,t]=r.useState(""),[m,R]=r.useState(!1),[h,u]=r.useState(!1),[x,j]=r.useState({token:o,id_asignacion:"",observaciones:""});r.useEffect(()=>{A()},[o]);const A=async()=>{try{l(!0);const{data:a}=await N.get(`/asistencia/registro/${o}`);a.success&&(v(a.data.sesion),b(a.data.asignacion),S(a.data.tiempo),j(n=>({...n,id_asignacion:a.data.asignacion.id_asignacion})))}catch(a){a.response?.status===404?t("SesiÃ³n de asistencia no encontrada"):a.response?.status===410?t("La sesiÃ³n de asistencia ha expirado"):t("Error al cargar la sesiÃ³n"),console.error("Error:",a)}finally{l(!1)}},y=a=>{const{name:n,value:c}=a.target;j(T=>({...T,[n]:c}))},_=async a=>{if(a.preventDefault(),!e?.permitido){t("â° El tiempo para registrar la asistencia ha expirado. El QR ya no es vÃ¡lido.");return}try{u(!0);const{data:n}=await N.post("/asistencia/registrar",x);n.success&&(R(!0),t(""),setTimeout(()=>{window.location.reload()},3e3))}catch(n){const c=n.response?.data?.message||"Error al registrar la asistencia";t(c),console.error("Error:",n)}finally{u(!1)}},p=()=>e?e.minutos_transcurridos<=15?"#10b981":e.minutos_transcurridos<=25?"#f59e0b":"#ef4444":"#666",g=()=>e?e.minutos_transcurridos<=15?"âœ…":e.minutos_transcurridos<=25?"âš ï¸":"âŒ":"â±ï¸";return E?s.jsx("div",{className:"registro-asistencia",children:s.jsxs("div",{className:"loading",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Cargando sesiÃ³n de asistencia..."})]})}):d&&!m?s.jsx("div",{className:"registro-asistencia",children:s.jsxs("div",{className:"error-container",children:[s.jsx("h2",{children:"âŒ Error"}),s.jsx("p",{children:d}),s.jsx("button",{onClick:()=>window.history.back(),children:"Volver"})]})}):m?s.jsx("div",{className:"registro-asistencia",children:s.jsxs("div",{className:"success-container",children:[s.jsx("h2",{children:"âœ… Asistencia Registrada"}),s.jsx("p",{children:"Tu asistencia ha sido registrada exitosamente."}),s.jsxs("div",{className:"success-details",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Docente:"})," ",i?.docente]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Materia:"})," ",i?.materia]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Grupo:"})," ",i?.grupo]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Aula:"})," ",i?.aula]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Estado Registrado:"})," ",e?.estado_temporal==="ASISTIO"?"âœ… Presente":e?.estado_temporal==="RETRASO"?"âš ï¸ Retraso":"âŒ Falta"]})]}),s.jsx("p",{className:"redirect-message",children:"Redirigiendo en 3 segundos..."})]})}):s.jsx("div",{className:"registro-asistencia",children:s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"header",children:[s.jsx("h1",{children:"ðŸ“‹ Registro de Asistencia"}),s.jsx("p",{children:"Completa el formulario para registrar tu asistencia"})]}),s.jsxs("div",{className:"estado-temporal",style:{borderLeftColor:p()},children:[s.jsxs("div",{className:"estado-header",children:[s.jsx("span",{className:"estado-icon",children:g()}),s.jsx("span",{className:"estado-title",children:"Estado Temporal"})]}),s.jsxs("div",{className:"estado-details",children:[s.jsxs("p",{className:"minutos",children:[s.jsx("strong",{children:"Minutos transcurridos:"})," ",e?.minutos_transcurridos]}),s.jsxs("p",{className:"rango",style:{color:p()},children:[s.jsx("strong",{children:"Rango:"})," ",e?.rango]}),s.jsxs("p",{className:"mensaje",children:[s.jsx("strong",{children:"Mensaje:"})," ",e?.mensaje]}),!e?.permitido&&s.jsxs("div",{className:"alerta-expiracion",children:["â° ",s.jsx("strong",{children:"ADVERTENCIA:"})," El tiempo para registrar la asistencia ha expirado. El QR ya no es vÃ¡lido."]})]})]}),s.jsxs("div",{className:"info-card",children:[s.jsx("h3",{children:"â„¹ï¸ InformaciÃ³n de la SesiÃ³n"}),s.jsxs("div",{className:"info-grid",children:[s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"label",children:"Docente:"}),s.jsx("span",{className:"value",children:i?.docente})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"label",children:"Materia:"}),s.jsx("span",{className:"value",children:i?.materia})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"label",children:"Grupo:"}),s.jsx("span",{className:"value",children:i?.grupo})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"label",children:"Aula:"}),s.jsx("span",{className:"value",children:i?.aula})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"label",children:"Hora de Inicio:"}),s.jsx("span",{className:"value",children:i?.hora_inicio})]}),s.jsxs("div",{className:"info-item",children:[s.jsx("span",{className:"label",children:"Tiempo Restante de SesiÃ³n:"}),s.jsxs("span",{className:"value",children:[f?.tiempo_restante," min"]})]})]})]}),e?.permitido?s.jsxs("form",{onSubmit:_,className:"form",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Estado de Asistencia *"}),s.jsxs("div",{className:"estado-info",children:[s.jsx("strong",{children:"Estado calculado automÃ¡ticamente:"})," ",g(),e?.estado_temporal==="ASISTIO"?" PRESENTE (0-15 min)":e?.estado_temporal==="RETRASO"?" RETRASO (16-25 min)":" FALTA (MÃ¡s de 25 min)"]}),s.jsx("input",{type:"hidden",name:"estado",value:e?.estado_temporal})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"observaciones",children:"Observaciones (Opcional)"}),s.jsx("textarea",{id:"observaciones",name:"observaciones",value:x.observaciones,onChange:y,placeholder:"Ingresa cualquier observaciÃ³n relevante...",className:"form-control",rows:"4"})]}),s.jsx("button",{type:"submit",className:"btn btn-primary",disabled:h,children:h?"Registrando...":"âœ… Registrar Asistencia"})]}):s.jsxs("div",{className:"form-disabled",children:[s.jsx("h3",{children:"âŒ No se puede registrar"}),s.jsx("p",{children:"El tiempo para registrar la asistencia ha expirado. No puedes registrar tu asistencia en este momento."}),s.jsx("button",{onClick:()=>window.history.back(),className:"btn btn-secondary",children:"Volver"})]})]})})};export{D as default};
