import{a as x,j as a}from"./index-ChjEM8xn.js";import{b as i}from"./react-vendor-AZ7bSPkM.js";/* empty css             */import"./axios-vendor-R-lXtGyY.js";const $=()=>{const[t,u]=i.useState([{nombre:"Mañana",hora_inicio:"06:00",hora_fin:"12:00",duracion_bloque_minutos:60},{nombre:"Tarde",hora_inicio:"13:00",hora_fin:"19:00",duracion_bloque_minutos:60}]),E=[{nombre:"Mañana",hora_inicio:"06:00",hora_fin:"12:00",duracion_bloque_minutos:60},{nombre:"Tarde",hora_inicio:"13:00",hora_fin:"19:00",duracion_bloque_minutos:60},{nombre:"Noche",hora_inicio:"19:00",hora_fin:"22:00",duracion_bloque_minutos:60}],M=()=>{u(E),setTimeout(()=>{w()},0)},[d,f]=i.useState([1,2,3,4,5]),[p,j]=i.useState([]),[n,l]=i.useState(!1),[y,s]=i.useState(null),[_,m]=i.useState(null),[v,g]=i.useState([]),[T,b]=i.useState(!0),C={1:"Lunes",2:"Martes",3:"Miércoles",4:"Jueves",5:"Viernes",6:"Sábado",7:"Domingo"};i.useEffect(()=>{console.log("ConfiguracionMalla montado, cargando franjas..."),k()},[]);const k=async()=>{try{l(!0);const r=await x.get("/malla-horaria"),e=r.data.data||r.data||[];j(e),s(null)}catch(r){console.error("Error al cargar franjas:",r.response?.data||r.message),s(`Error al cargar las franjas horarias: ${r.response?.data?.error||r.response?.data?.message||r.message}`)}finally{l(!1)}},h=(r,e,o)=>{const c=[...t];c[r][e]=o,u(c)},S=()=>{u([...t,{nombre:"",hora_inicio:"06:00",hora_fin:"12:00",duracion_bloque_minutos:60}])},N=r=>{u(t.filter((e,o)=>o!==r))},R=r=>{d.includes(r)?f(d.filter(e=>e!==r)):f([...d,r].sort())},w=async()=>{try{if(l(!0),s(null),g([]),t.filter(o=>!o.nombre||o.nombre.trim()==="").length>0){s("Todos los turnos deben tener un nombre"),l(!1);return}if(d.length===0){s("Debe seleccionar al menos un día de la semana"),l(!1);return}const e=await x.post("/malla-horaria",{turnos:t,dias_semana:d});m(`✓ Malla horaria generada exitosamente: ${e.data.franjas_creadas} franjas creadas`),b(!1),setTimeout(()=>{k()},1e3)}catch(r){console.error("Error al generar malla:",r),s(r.response?.data?.error||"Error al generar la malla horaria")}finally{l(!1)}},q=async()=>{try{l(!0);const r=await x.post("/malla-horaria/validar",{});r.data.valido?(m(`✓ Validación exitosa: ${r.data.total_franjas} franjas sin solapamientos`),g([])):(g(r.data.errores),s("Se encontraron solapamientos en la malla horaria"))}catch(r){console.error("Error al validar franjas:",r),s("Error al validar las franjas")}finally{l(!1)}},F=async()=>{if(window.confirm("¿Está seguro de que desea eliminar toda la malla horaria?"))try{l(!0),await x.delete("/malla-horaria-eliminar"),m("✓ Malla horaria eliminada exitosamente"),j([]),b(!0),s(null)}catch(r){console.error("Error al eliminar malla:",r),s("Error al eliminar la malla horaria")}finally{l(!1)}};return a.jsxs("div",{className:"container",children:[a.jsx("h1",{children:"CU10: Configurar Malla Horaria"}),y&&a.jsx("div",{className:"alert alert-error",children:y}),_&&a.jsx("div",{className:"alert alert-success",children:_}),v.length>0&&a.jsxs("div",{className:"alert alert-warning",children:[a.jsx("strong",{children:"Errores de validación:"}),a.jsx("ul",{children:v.map((r,e)=>a.jsx("li",{children:r},e))})]}),T&&p.length===0&&a.jsxs("div",{className:"form-section",children:[a.jsx("h2",{children:"Generar Nueva Malla Horaria"}),a.jsxs("div",{className:"form-group",children:[a.jsx("h3",{children:"Turnos"}),a.jsx("button",{onClick:M,style:{marginBottom:"15px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",padding:"8px 15px",cursor:"pointer"},children:"Generar Malla Automática"}),t.map((r,e)=>a.jsxs("div",{className:"turno-row",style:{marginBottom:"20px",padding:"10px",border:"1px solid #ddd",borderRadius:"5px"},children:[a.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"10px"},children:[a.jsx("input",{type:"text",placeholder:"Nombre del turno",value:r.nombre,onChange:o=>h(e,"nombre",o.target.value),style:{padding:"8px"}}),a.jsx("input",{type:"time",value:r.hora_inicio,onChange:o=>h(e,"hora_inicio",o.target.value),style:{padding:"8px"}}),a.jsx("input",{type:"time",value:r.hora_fin,onChange:o=>h(e,"hora_fin",o.target.value),style:{padding:"8px"}}),a.jsx("input",{type:"number",placeholder:"Duración (min)",value:r.duracion_bloque_minutos,onChange:o=>h(e,"duracion_bloque_minutos",parseInt(o.target.value)),style:{padding:"8px"}})]}),t.length>1&&a.jsx("button",{onClick:()=>N(e),style:{marginTop:"10px",padding:"5px 10px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Eliminar"})]},e)),a.jsx("button",{onClick:S,style:{padding:"8px 15px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginBottom:"15px"},children:"+ Agregar Turno"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("h3",{children:"Días de la Semana"}),a.jsx("div",{style:{display:"flex",gap:"15px",flexWrap:"wrap"},children:Object.entries(C).map(([r,e])=>a.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[a.jsx("input",{type:"checkbox",checked:d.includes(parseInt(r)),onChange:()=>R(parseInt(r))}),e]},r))})]}),a.jsx("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:a.jsx("button",{onClick:w,disabled:n,style:{padding:"10px 20px",backgroundColor:"#28a745",color:"white",border:"none",borderRadius:"4px",cursor:n?"not-allowed":"pointer",opacity:n?.6:1},children:n?"Generando...":"Generar Malla"})})]}),p.length>0&&a.jsxs("div",{className:"form-section",style:{marginTop:"30px"},children:[a.jsx("h2",{children:"Malla Horaria Actual"}),a.jsx("div",{style:{marginBottom:"20px"},children:a.jsxs("strong",{children:["Total de franjas: ",p.length]})}),Object.entries(p.reduce((r,e)=>{const o=`${e.turno}_${e.dias_semana}`;return r[o]||(r[o]=[]),r[o].push(e),r},{})).sort().map(([r,e])=>a.jsxs("div",{style:{marginBottom:"20px",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"5px"},children:[a.jsxs("h4",{children:[e[0].turno," - ",C[e[0].dias_semana]]}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{backgroundColor:"#e9ecef"},children:[a.jsx("th",{style:{padding:"8px",border:"1px solid #dee2e6",textAlign:"left"},children:"Inicio"}),a.jsx("th",{style:{padding:"8px",border:"1px solid #dee2e6",textAlign:"left"},children:"Fin"})]})}),a.jsx("tbody",{children:e.map((o,c)=>a.jsxs("tr",{style:{backgroundColor:c%2===0?"#fff":"#f8f9fa"},children:[a.jsx("td",{style:{padding:"8px",border:"1px solid #dee2e6"},children:o.hora_inicio}),a.jsx("td",{style:{padding:"8px",border:"1px solid #dee2e6"},children:o.hora_fin})]},c))})]})]},r)),a.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[a.jsx("button",{onClick:q,disabled:n,style:{padding:"10px 20px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:n?"not-allowed":"pointer",opacity:n?.6:1},children:n?"Validando...":"Validar Franjas"}),a.jsx("button",{onClick:()=>{b(!0),s(null),m(null)},style:{padding:"10px 20px",backgroundColor:"#17a2b8",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Regenerar Malla"}),a.jsx("button",{onClick:F,disabled:n,style:{padding:"10px 20px",backgroundColor:"#dc3545",color:"white",border:"none",borderRadius:"4px",cursor:n?"not-allowed":"pointer",opacity:n?.6:1},children:n?"Eliminando...":"Eliminar Malla"})]})]})]})};export{$ as default};
